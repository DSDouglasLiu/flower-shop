<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¨‚èŠ±æœå‹™</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <style>
        body { background-color: #f8f9fa; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .product-img { width: 100%; height: 300px; object-fit: cover; border-radius: 10px; background-color: #eee; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .cart-summary { background: white; border-top: 1px solid #ddd; position: fixed; bottom: 0; left: 0; width: 100%; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; display: none; }
        .container { padding-bottom: 100px; } 
        .section-title { border-left: 5px solid #0d6efd; padding-left: 10px; margin: 20px 0 10px 0; font-weight: bold; }
    </style>
</head>
<body>

    <div id="loading" class="loading-overlay">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2">è¼‰å…¥ç³»çµ±ä¸­...</p>
    </div>

    <div class="modal fade" id="eulaModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="eulaTitle">æœå‹™æ¢æ¬¾</h5></div>
                <div class="modal-body"><pre id="eulaContent" style="white-space: pre-wrap; font-family: inherit; color: #555;"></pre></div>
                <div class="modal-footer"><button type="button" class="btn btn-primary w-100" onclick="acceptEULA()">æˆ‘åŒæ„ä¸¦é–‹å§‹</button></div>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-light bg-white border-bottom sticky-top" id="navBar" style="display:none;">
        <div class="container-fluid justify-content-center">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary active" id="btnTabOrder" onclick="switchTab('order')">æˆ‘è¦è¨‚èŠ±</button>
                <button type="button" class="btn btn-outline-primary" id="btnTabCheck" onclick="switchTab('check')">æŸ¥è©¢/å–æ¶ˆ</button>
            </div>
        </div>
    </nav>

    <div class="container mt-3 pb-5">

        <div id="pageOrder" style="display:none;">
            <h4 class="text-center mb-3">ğŸŒº é¸æ“‡å•†å“</h4>
            
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <img id="productImg" src="" class="product-img mb-3" alt="å•†å“åœ–ç‰‡">
                    <h5 id="productDesc" class="fw-bold text-dark">è¼‰å…¥ä¸­...</h5>
                    <p id="productPrice" class="text-danger fw-bold fs-4">$0</p>
                    <hr>
                    <div class="mb-3">
                        <label>ç­‰ç´š</label>
                        <select id="gradeSelect" class="form-select" onchange="onGradeChange()"></select>
                    </div>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <label>æœµæ•¸</label>
                            <select id="countSelect" class="form-select" onchange="updatePriceDisplay()"></select>
                        </div>
                        <div class="col-6 mb-3">
                            <label>èŠ±ç“£</label>
                            <select id="petalSelect" class="form-select"></select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label>é¡è‰²</label>
                        <select id="colorSelect" class="form-select"></select>
                    </div>
                    <button class="btn btn-outline-primary w-100" onclick="addToCart()">åŠ å…¥è³¼ç‰©è»Š ğŸ›’</button>
                </div>
            </div>

            <div id="cartSection" style="display:none;">
                <div class="section-title">è³¼ç‰©è»Šå…§å®¹</div>
                <ul class="list-group mb-3" id="cartList"></ul>
                
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="section-title" style="margin-top:0;">å–è²¨è³‡è¨Š</div>
                        <div class="mb-3">
                            <label>å–è²¨æ—¥æœŸ</label>
                            <select id="pickupDate" class="form-select" onchange="updateTimeSlots()">
                                <option value="">è«‹å…ˆé¸æ“‡æ—¥æœŸ</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label>å–è²¨æ™‚æ®µ</label>
                            <select id="pickupTime" class="form-select"></select>
                        </div>
                        <div class="mb-3">
                            <label>æ‚¨çš„å§“å</label>
                            <input type="text" id="custName" class="form-control" placeholder="è«‹è¼¸å…¥å…¨å">
                        </div>
                        <div class="mb-3">
                            <label>è¯çµ¡é›»è©±</label>
                            <input type="tel" id="custPhone" class="form-control" placeholder="09xx-xxx-xxx">
                        </div>
                        <div class="mb-3">
                            <label>å‚™è¨»</label
